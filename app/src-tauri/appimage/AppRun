#!/bin/bash
# Custom AppRun script for Observer AI with native Wayland support

# Get the directory where this AppImage is located
APPDIR="$(dirname "$(readlink -f "$0")")"

# Detect if we're running under Wayland
# Check if WAYLAND_DISPLAY is set and the socket actually exists
if [ -n "$WAYLAND_DISPLAY" ] && [ -e "${XDG_RUNTIME_DIR}/${WAYLAND_DISPLAY}" ]; then
    # Enable Wayland support for GTK and other libraries
    export GDK_BACKEND=wayland
    export QT_QPA_PLATFORM=wayland
    # Ensure EGL uses Wayland platform - this fixes the EGL_BAD_PARAMETER error
    export EGL_PLATFORM=wayland
    echo "Running in Wayland mode"
elif [ -n "$DISPLAY" ]; then
    # Fall back to X11
    export GDK_BACKEND=x11
    export QT_QPA_PLATFORM=xcb
    echo "Running in X11 mode"
else
    # No display server detected, try Wayland first
    export GDK_BACKEND=wayland
    export EGL_PLATFORM=wayland
    echo "No display server detected, attempting Wayland"
fi

# Run the actual application binary
exec "$APPDIR/usr/bin/app" "$@"
